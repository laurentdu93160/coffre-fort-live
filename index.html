<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <title>Coffre-fort Live</title>
  <style>
    body {
      margin: 0;
      background: linear-gradient(135deg, #0f111a, #1e202b);
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      overflow: hidden;
      font-family: sans-serif;
    }

    #coffre {
      position: relative;
      width: 300px;
    }

    svg {
      width: 100%;
      height: auto;
    }

    .code {
      position: absolute;
      top: -40px;
      left: 0;
      right: 0;
      text-align: center;
      font-size: 24px;
      color: #fff;
      letter-spacing: 8px;
    }

    .led {
      transition: opacity 0.2s;
    }

    .vert {
      fill: limegreen;
      opacity: 0;
    }

    .rouge {
      fill: crimson;
      opacity: 0;
    }

    .clignote {
      animation: blink 0.3s alternate 6;
    }

    @keyframes blink {
      to { opacity: 1; }
    }

    .poignee {
      transform-origin: center;
      transition: transform 1s ease-out;
    }

    .tourne {
      transform: rotate(180deg);
    }

    .porte {
      transition: transform 1s ease-out;
    }

    .ouvert {
      transform: translateX(120px);
    }

    .touche {
      cursor: pointer;
    }

    .fondAnime {
      position: absolute;
      top: -80px;
      left: -80px;
      width: 460px;
      height: 460px;
      border-radius: 50%;
      background: radial-gradient(circle, rgba(0,255,255,0.1) 0%, transparent 70%);
      animation: pulse 4s infinite;
      z-index: -1;
    }

    @keyframes pulse {
      0%, 100% { transform: scale(1); opacity: 0.2; }
      50% { transform: scale(1.3); opacity: 0.4; }
    }
  </style>
</head>
<body>
  <div id="coffre">
    <div class="fondAnime"></div>
    <div class="code" id="afficheCode">____</div>
    <svg viewBox="0 0 300 300">
      <rect x="10" y="10" width="280" height="280" rx="20" ry="20" fill="#333" stroke="#888" stroke-width="4"/>
      <circle cx="150" cy="90" r="30" class="poignee" fill="#666" stroke="#aaa" stroke-width="4"/>
      <circle cx="40" cy="40" r="10" class="led vert"/>
      <circle cx="260" cy="40" r="10" class="led rouge"/>
      <rect x="70" y="150" width="160" height="100" fill="#222" stroke="#555" stroke-width="2"/>
      <!-- Boutons du clavier -->
      <g id="clavier">
        <circle cx="100" cy="170" r="12" class="touche" fill="#999"/><text x="100" y="175" font-size="12" text-anchor="middle" fill="#000">1</text>
        <circle cx="150" cy="170" r="12" class="touche" fill="#999"/><text x="150" y="175" font-size="12" text-anchor="middle" fill="#000">2</text>
        <circle cx="200" cy="170" r="12" class="touche" fill="#999"/><text x="200" y="175" font-size="12" text-anchor="middle" fill="#000">3</text>
        <circle cx="100" cy="200" r="12" class="touche" fill="#999"/><text x="100" y="205" font-size="12" text-anchor="middle" fill="#000">4</text>
        <circle cx="150" cy="200" r="12" class="touche" fill="#999"/><text x="150" y="205" font-size="12" text-anchor="middle" fill="#000">5</text>
        <circle cx="200" cy="200" r="12" class="touche" fill="#999"/><text x="200" y="205" font-size="12" text-anchor="middle" fill="#000">6</text>
        <circle cx="100" cy="230" r="12" class="touche" fill="#999"/><text x="100" y="235" font-size="12" text-anchor="middle" fill="#000">7</text>
        <circle cx="150" cy="230" r="12" class="touche" fill="#999"/><text x="150" y="235" font-size="12" text-anchor="middle" fill="#000">8</text>
        <circle cx="200" cy="230" r="12" class="touche" fill="#999"/><text x="200" y="235" font-size="12" text-anchor="middle" fill="#000">9</text>
        <circle cx="150" cy="260" r="12" class="touche" fill="#999"/><text x="150" y="265" font-size="12" text-anchor="middle" fill="#000">0</text>
      </g>
      <!-- Porte -->
      <rect x="10" y="10" width="280" height="280" rx="20" ry="20" fill="none" stroke="#fff" stroke-width="4" class="porte"/>
    </svg>
  </div>

  <script>
    let codeSecret = genererCode();
    let entreCode = [];
    const touches = document.querySelectorAll('.touche');
    const afficheCode = document.getElementById('afficheCode');
    const ledRouge = document.querySelector('.led.rouge');
    const ledVerte = document.querySelector('.led.vert');
    const poignee = document.querySelector('.poignee');
    const porte = document.querySelector('.porte');

    function genererCode() {
      return String(Math.floor(1000 + Math.random() * 9000));
    }

    function mettreAJourAffichage() {
      afficheCode.textContent = entreCode.map(n => n).join('').padEnd(4, '_');
    }

    touches.forEach((btn, i) => {
      btn.addEventListener('click', () => {
        const chiffre = btn.nextElementSibling.textContent;
        if (entreCode.length < 4) {
          entreCode.push(chiffre);
          mettreAJourAffichage();
        }
        if (entreCode.length === 4) {
          const codeEntre = entreCode.join('');
          if (codeEntre === codeSecret) {
            ledVerte.classList.add('clignote');
            poignee.classList.add('tourne');
            porte.classList.add('ouvert');
            setTimeout(() => {
              ledVerte.classList.remove('clignote');
              poignee.classList.remove('tourne');
              porte.classList.remove('ouvert');
              entreCode = [];
              codeSecret = genererCode();
              mettreAJourAffichage();
            }, 3000);
          } else {
            ledRouge.classList.add('clignote');
            setTimeout(() => {
              ledRouge.classList.remove('clignote');
              entreCode = [];
              mettreAJourAffichage();
            }, 1200);
          }
        }
      });
    });

    mettreAJourAffichage();
  </script>
</body>
</html>
