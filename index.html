<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <title>Coffre-fort Live</title>
  <style>
    body {
      margin: 0;
      background: linear-gradient(135deg, #0f111a, #1e202b);
      font-family: sans-serif;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
    }
    #interface {
      text-align: center;
      color: #fff;
    }
    .code {
      font-size: 24px;
      letter-spacing: 6px;
      margin-bottom: 20px;
    }
    .clavier {
      display: grid;
      grid-template-columns: repeat(3, 80px);
      grid-gap: 12px;
      justify-content: center;
    }
    .touche {
      padding: 20px;
      background: #444;
      color: #fff;
      font-size: 20px;
      border-radius: 8px;
      cursor: pointer;
      user-select: none;
      box-shadow: 0 4px #222;
      transition: background 0.2s;
    }
    .touche:active {
      background: #666;
    }
    .led {
      width: 12px;
      height: 12px;
      border-radius: 50%;
      margin: 10px auto;
      opacity: 0;
    }
    .led.verte { background: limegreen; }
    .led.rouge { background: crimson; }
    .clignote {
      animation: blink 0.3s alternate 6;
    }
    @keyframes blink {
      to { opacity: 1; }
    }
  </style>
</head>
<body>
  <div id="interface">
    <div class="code" id="afficheCode">____</div>
    <div class="led verte" id="ledVerte"></div>
    <div class="led rouge" id="ledRouge"></div>
    <div class="clavier" id="clavier">
      <!-- Chiffres 1 Ã  9 -->
      <div class="touche">1</div><div class="touche">2</div><div class="touche">3</div>
      <div class="touche">4</div><div class="touche">5</div><div class="touche">6</div>
      <div class="touche">7</div><div class="touche">8</div><div class="touche">9</div>
      <!-- Effacer, 0, OK -->
      <div class="touche" data-action="clear">Effacer</div>
      <div class="touche">0</div>
      <div class="touche" data-action="ok">OK</div>
    </div>
    <!-- Son d'ouverture -->
    <audio id="sonOuverture" src="https://assets.mixkit.co/sfx/preview/mixkit-lock-opening-2870.mp3"></audio>
  </div>

  <script>
    let codeSecret = genererCode();
    console.log("Code secret :", codeSecret);
    let entreCode = [];
    const afficheCode = document.getElementById("afficheCode");
    const clavier = document.getElementById("clavier");
    const ledVerte = document.getElementById("ledVerte");
    const ledRouge = document.getElementById("ledRouge");
    const sonOuverture = document.getElementById("sonOuverture");

    function genererCode() {
      return String(Math.floor(1000 + Math.random() * 9000));
    }

    function mettreAJourAffichage() {
      afficheCode.textContent = entreCode.join('').padEnd(4, '_');
    }

    function verifieCode() {
      if (entreCode.join('') === codeSecret) {
        ledVerte.classList.add("clignote");
        sonOuverture.play();
        setTimeout(() => {
          ledVerte.classList.remove("clignote");
          codeSecret = genererCode();
          console.log("Code secret :", codeSecret);
          entreCode = [];
          mettreAJourAffichage();
        }, 3000);
      } else {
        ledRouge.classList.add("clignote");
        setTimeout(() => {
          ledRouge.classList.remove("clignote");
          entreCode = [];
          mettreAJourAffichage();
        }, 1200);
      }
    }

    clavier.addEventListener("click", e => {
      const txt = e.target.textContent;
      if (!e.target.classList.contains("touche")) return;

      if (e.target.dataset.action === "clear") {
        entreCode = [];
        mettreAJourAffichage();
      } else if (e.target.dataset.action === "ok") {
        if (entreCode.length === 4) verifieCode();
      } else {
        if (entreCode.length < 4) {
          entreCode.push(txt);
          mettreAJourAffichage();
        }
      }
    });

    window.addEventListener("keydown", e => {
      const key = e.key;
      if (/^[0-9]$/.test(key)) {
        if (entreCode.length < 4) {
          entreCode.push(key);
          mettreAJourAffichage();
        }
      } else if (key === "Backspace") {
        entreCode = [];
        mettreAJourAffichage();
      } else if (key === "Enter") {
        if (entreCode.length === 4) verifieCode();
      }
    });

    mettreAJourAffichage();
  </script>
</body>
</html>
